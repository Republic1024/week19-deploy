<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left: 0.25em solid rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root{--bg-color:#fff;--select-text-bg-color:#666;--text-color:#323232;--primary-color:#ff8c00;--rawblock-edit-panel-bd:#f2f2f2;--item-hover-bg-color:#ff8c00;--control-text-hover-color:#ff8c00;--md-char-color:rgba(72,93,108,0.75);--meta-content-color:var(--md-char-color);--primary-btn-text-color:var(--text-color);--active-file-bg-color:var(--bg-color);--active-file-text-color:#fff;--item-hover-text-color:#fff}html{font-size:1rem;-webkit-font-smoothing:antialiased}body{-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;font-family:"Microsoft YaHei","PingFang SC","Arial","sans-serif";color:var(--text-color);line-height:1.6;background-color:var(--bg-color);caret-color:var(--primary-color)}::-webkit-scrollbar-thumb{background:#ff8c00}::-webkit-scrollbar-thumb:active{background:#00cd66}#typora-sidebar:hover div.sidebar-content-content::-webkit-scrollbar-thumb:horizontal{background:rgba(230,230,230,0.3)}.typora-node::-webkit-scrollbar{width:5px}.typora-node::-webkit-scrollbar-thumb:vertical{background:rgba(250,250,250,0.3)}.typora-node::-webkit-scrollbar-thumb:vertical:active{background:rgba(250,250,250,0.5)}h1{font-size:2rem;font-weight:2000;font-family:"Microsoft YaHei","PingFang SC","Arial","sans-serif";line-height:1.2;text-align:center}h2{font-size:1.8rem;display:inline-flex;align-items:center;margin-bottom:0}h2::before{content:'';width:.5rem;height:2rem;margin-right:.5rem;background:linear-gradient(45deg, #e9a11a,#eab211,#e8c40a,#e5d50f,#dee71d);border-radius:6px}h2:hover::before,#write>h2.md-focus::after{background:linear-gradient(45deg, #0ba360,#39b05d,#57bc5a,#72c856,#8ed451)}h3{position:relative;font-size:1.6rem;font-weight:700;margin-top:.8rem;margin-bottom:.8rem;line-height:1.4;cursor:text;font-family:"Microsoft YaHei","PingFang SC","Arial","sans-serif"}h3::after{content:"";position:absolute;left:0;bottom:-.3rem;width:3rem;height:0.3rem;background-image:linear-gradient(to right, #e9a11a,#eab211,#e8c40a,#e5d50f,#dee71d);border-radius:6px}#write>h3.md-focus::after{content:"";width:6rem;height:0.3rem;background-image:linear-gradient(to right, #0ba360,#39b05d,#57bc5a,#72c856,#8ed451);border-radius:6px;transition:width 1s ease-in-out}h4{font-size:1.4rem;font-weight:500;line-height:1.43;border-bottom:1px dashed #ff8c00;margin-top:.8rem;margin-bottom:.8rem;line-height:1.4;cursor:text;font-family:"Microsoft YaHei","PingFang SC","Arial","sans-serif"}#write>h4.md-focus{border-bottom-color:#00cd66;transition:border-bottom-color 0.5s linear}h5{color:#ff8c00;font-weight:300;font-size:1.2rem;margin-top:.8rem;margin-bottom:.8rem;line-height:1.4;cursor:text;font-family:"Microsoft YaHei","PingFang SC","Arial","sans-serif"}h5:hover{animation:bounce 2s infinite}@keyframes bounce{0%,100%,20%,50%,80%{transform:translateY(0)}40%{transform:translateY(-1rem)}60%{transform:translateY(-1rem)}}#write>h5.md-focus:before{width:auto;height:auto;background-color:#00cd66;color:#ffffff}sup.md-footnote{background-color:var(--rawblock-edit-panel-bd);color:#ff8c00}p{-ms-word-wrap:break-word;word-wrap:break-word}p.md-focus>span.md-plain.md-expand{border-bottom:2px dashed #00cd66;color:#00cd66}a{color:var(--text-color);text-decoration:none;border-bottom:2px solid #ff8c00}span[alt="black"]{margin-left:0.2em;padding:0 0.5em;color:white;border-radius:6px;background-image:linear-gradient(to right, #596164,#646c70,#6f787d,#7a8389,#868f96)}span[alt="blue"]{margin-left:0.2em;padding:0 0.5em;color:white;border-radius:6px;background-image:linear-gradient(to right, #005bea,#007bf9,#0097ff,#00affe,#00c6fb)}span[alt="orange"]{margin-left:0.2em;padding:0 0.5em;color:white;border-radius:6px;background-image:linear-gradient(to right, #e9a11a,#eab211,#e8c40a,#e5d50f,#dee71d)}span[alt="purple"]{margin-left:0.2em;padding:0 0.5em;color:white;border-radius:6px;background-image:linear-gradient(to right, #c471f5,#d66feb,#e46fe1,#f06fd7,#fa71cd)}span[alt="green"]{margin-left:0.2em;padding:0 0.5em;color:white;border-radius:6px;background-image:linear-gradient(to right, #0ba360,#39b05d,#57bc5a,#72c856,#8ed451)}span[alt="red"]{margin-left:0.2em;padding:0 0.5em;color:white;border-radius:6px;background-image:linear-gradient(to right, #ed2842,#f33d58,#f7506d,#fa6181,#fb7294)}p,blockquote,ul,ol,dl,table{margin:0.8em 0}li>ol,li>ul{margin:0 0}hr{margin:16px 0;border-top:2px dashed #ff8c00}li p.first{display:inline-block}ul,ol{padding-left:30px}ul:first-child,ol:first-child{margin-top:0}ul:last-child,ol:last-child{margin-bottom:0}li::marker{color:#ff8c00}blockquote{text-indent:0em;line-height:inherit;min-height:1.5rem;margin:1em 0;padding:12px 0 8px 10px;border-radius:6px;border-left:8px solid transparent;background-clip:padding-box, border-box;background-origin:padding-box, border-box;overflow:hidden;color:#ff8c00;background-image:linear-gradient(to right, var(--rawblock-edit-panel-bd), var(--rawblock-edit-panel-bd)),linear-gradient(0deg, #ff8c00 0%, #ff8c00 100%);color:var(--text-color)}blockquote img{position:relative;transform:translateY(26.8px);height:1rem;margin-right:0.2rem;filter:drop-shadow(#ff8c00 0px -28px)}h2+blockquote,blockquote[alt="green"]{text-indent:0em;line-height:inherit;min-height:1.5rem;margin:1em 0;padding:12px 0 8px 10px;border-radius:6px;border-left:8px solid transparent;background-clip:padding-box, border-box;background-origin:padding-box, border-box;overflow:hidden;background-image:linear-gradient(to right, var(--rawblock-edit-panel-bd), var(--rawblock-edit-panel-bd)),linear-gradient(0deg, #0ba360,#39b05d,#57bc5a,#72c856,#8ed451);color:#00cd66}h2+blockquote img,blockquote[alt="green"] img{position:relative;transform:translateY(26.8px);height:1rem;margin-right:0.2rem;color:#00cd66;filter:drop-shadow(#00cd66 0px -28px)}h3+blockquote,blockquote[alt="blue"]{text-indent:0em;line-height:inherit;min-height:1.5rem;margin:1em 0;padding:12px 0 8px 10px;border-radius:6px;border-left:8px solid transparent;background-clip:padding-box, border-box;background-origin:padding-box, border-box;overflow:hidden;background-image:linear-gradient(to right, var(--rawblock-edit-panel-bd), var(--rawblock-edit-panel-bd)),linear-gradient(0deg, #005bea,#007bf9,#0097ff,#00affe,#00c6fb);color:#00bfff}h3+blockquote img,blockquote[alt="blue"] img{position:relative;transform:translateY(26.8px);height:1rem;margin-right:0.2rem;filter:drop-shadow(#00bfff 0px -28px)}h4+blockquote,blockquote[alt="orange"]{text-indent:0em;line-height:inherit;min-height:1.5rem;margin:1em 0;padding:12px 0 8px 10px;border-radius:6px;border-left:8px solid transparent;background-clip:padding-box, border-box;background-origin:padding-box, border-box;overflow:hidden;background-image:linear-gradient(to right, var(--rawblock-edit-panel-bd), var(--rawblock-edit-panel-bd)),linear-gradient(0deg, #e9a11a,#eab211,#e8c40a,#e5d50f,#dee71d);color:#ff8c00}h4+blockquote img,blockquote[alt="orange"] img{position:relative;transform:translateY(26.8px);height:1rem;margin-right:0.2rem;filter:drop-shadow(#ff8c00 0px -28px)}h5+blockquote,blockquote[alt="purple"]{text-indent:0em;line-height:inherit;min-height:1.5rem;margin:1em 0;padding:12px 0 8px 10px;border-radius:6px;border-left:8px solid transparent;background-clip:padding-box, border-box;background-origin:padding-box, border-box;overflow:hidden;background-image:linear-gradient(to right, var(--rawblock-edit-panel-bd), var(--rawblock-edit-panel-bd)),linear-gradient(0deg, #c471f5,#d66feb,#e46fe1,#f06fd7,#fa71cd);color:#f0f}h5+blockquote img,blockquote[alt="purple"] img{position:relative;transform:translateY(26.8px);height:1rem;margin-right:0.2rem;filter:drop-shadow(#f0f 0px -28px)}blockquote[alt="red"]{text-indent:0em;line-height:inherit;min-height:1.5rem;margin:1em 0;padding:12px 0 8px 10px;border-radius:6px;border-left:8px solid transparent;background-clip:padding-box, border-box;background-origin:padding-box, border-box;overflow:hidden;background-image:linear-gradient(to right, var(--rawblock-edit-panel-bd), var(--rawblock-edit-panel-bd)),linear-gradient(0deg, #ed2842,#f33d58,#f7506d,#fa6181,#fb7294);color:#f14669}blockquote[alt="red"] img{position:relative;transform:translateY(26.8px);height:1rem;margin-right:0.2rem;filter:drop-shadow(#f0f 0px -28px)}section[alt="note"],section[alt="info"],section[alt="tip"],section[alt="warning"],section[alt="caution"],section[alt="important"]{padding:10px 20px;border-radius:6px;color:white;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,0.2);border-left:none !important;display:flex}section[alt="note"]::before,section[alt="info"]::before,section[alt="tip"]::before,section[alt="warning"]::before,section[alt="caution"]::before,section[alt="important"]::before{margin-left:-2rem;margin-right:1rem;text-align:center;width:1.5rem;height:1.5rem;border-radius:50%;border:3px solid white}.md-alert-text-container::after{color:white}.md-alert-text-note,.md-alert-text-caution,.md-alert-text-tip,.md-alert-text-important,.md-alert-text-warning{color:white}.md-alert.md-alert-note{padding:10px 20px;border-radius:6px;color:white;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,0.2);border-left:none !important;background:linear-gradient(to right, #596164,#646c70,#6f787d,#7a8389,#868f96)}.md-alert.md-alert-caution{padding:10px 20px;border-radius:6px;color:white;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,0.2);border-left:none !important;background:linear-gradient(to right, #ed2842,#f33d58,#f7506d,#fa6181,#fb7294)}.md-alert.md-alert-tip{padding:10px 20px;border-radius:6px;color:white;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,0.2);border-left:none !important;background:linear-gradient(to right, #0ba360,#39b05d,#57bc5a,#72c856,#8ed451)}.md-alert.md-alert-important{padding:10px 20px;border-radius:6px;color:white;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,0.2);border-left:none !important;background:linear-gradient(to right, #c471f5,#d66feb,#e46fe1,#f06fd7,#fa71cd)}.md-alert.md-alert-warning{padding:10px 20px;border-radius:6px;color:white;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,0.2);border-left:none !important;background:linear-gradient(to right, #e9a11a,#eab211,#e8c40a,#e5d50f,#dee71d)}section[alt="note"]{background:linear-gradient(to right, #596164,#646c70,#6f787d,#7a8389,#868f96)}section[alt="note"]::before{content:url("file:///C://Users//Administrator//AppData//Roaming//Typora/themes/foresee/icon/info.svg");background:linear-gradient(to right, #596164,#646c70,#6f787d,#7a8389,#868f96)}section[alt="info"]{background:linear-gradient(to right, #005bea,#007bf9,#0097ff,#00affe,#00c6fb)}section[alt="info"]::before{content:url("file:///C://Users//Administrator//AppData//Roaming//Typora/themes/foresee/icon/correct.svg");background:linear-gradient(to right, #005bea,#007bf9,#0097ff,#00affe,#00c6fb)}section[alt="tip"]{background:linear-gradient(to right, #0ba360,#39b05d,#57bc5a,#72c856,#8ed451)}section[alt="tip"]::before{content:url("file:///C://Users//Administrator//AppData//Roaming//Typora/themes/foresee/icon/question.svg");background:linear-gradient(to right, #0ba360,#39b05d,#57bc5a,#72c856,#8ed451)}section[alt="warning"]{background:linear-gradient(to right, #e9a11a,#eab211,#e8c40a,#e5d50f,#dee71d)}section[alt="warning"]::before{content:url("file:///C://Users//Administrator//AppData//Roaming//Typora/themes/foresee/icon/alert.svg");background:linear-gradient(to right, #e9a11a,#eab211,#e8c40a,#e5d50f,#dee71d)}section[alt="caution"]{background:linear-gradient(to right, #ed2842,#f33d58,#f7506d,#fa6181,#fb7294)}section[alt="caution"]::before{content:url("file:///C://Users//Administrator//AppData//Roaming//Typora/themes/foresee/icon/caution.svg");background:linear-gradient(to right, #ed2842,#f33d58,#f7506d,#fa6181,#fb7294)}section[alt="important"]{background:linear-gradient(to right, #c471f5,#d66feb,#e46fe1,#f06fd7,#fa71cd)}section[alt="important"]::before{content:url("file:///C://Users//Administrator//AppData//Roaming//Typora/themes/foresee/icon/alert.svg");background:linear-gradient(to right, #c471f5,#d66feb,#e46fe1,#f06fd7,#fa71cd)}table{border-collapse:collapse;margin:0 auto;padding:0;word-break:initial}table td{font-weight:normal;text-align:left}table td::selection{background-color:#fff;color:#fff}thead,th,td{border:1px solid #ff8c00}th,td{padding:0.6em;font-family:"Microsoft YaHei","PingFang SC","Arial","sans-serif"}table th{color:#ff8c00;text-align:center}mark{background-color:#00cd66;color:var(--rawblock-edit-panel-bd)}::-moz-selection{background:#ff8c00;color:#fff;text-shadow:none}*.in-text-selection,::selection{background:#ff8c00;color:#fff;text-shadow:none}#top-titlebar,#top-titlebar *{color:#fff}#write pre.md-meta-block{color:var(--text-color);padding:1em;line-height:1.6em;background:var(--rawblock-edit-panel-bd);border-radius:6px}code,kbd{padding:0.3rem;margin-right:0.4em;color:#dedede;border-radius:6px;background-color:#323232}em{font-style:normal;border-bottom:4px dotted #00cd66}u{text-decoration-style:solid;text-decoration-line:underline;text-decoration-thickness:0.1rem;text-decoration-color:#00cd66}pre.md-fences{padding:10px 10px 10px 30px;margin-bottom:20px;background-color:var(--rawblock-edit-panel-bd)}#ty-tooltip{background-color:#fff;color:var(--text-color)}.task-list{padding-left:0}.md-task-list-item>input{margin-left:-1.3em;margin-top:0.3rem;appearance:none;-webkit-appearance:none;-moz-appearance:none}.md-task-list-item>input ::after{content:"";position:absolute;top:0;display:inline-block;width:1rem;height:1rem;padding-left:0px;color:#fff;text-align:center;border:1px solid #ff8c00}.md-task-list-item>input :checked::after{content:"✓";font-size:12px;background-color:#ff8c00;border-radius:2px}#typora-sidebar{box-shadow:none;border-right:none;background-color:var(--rawblock-edit-panel-bd)}.sidebar-tabs{border-bottom:0}#typora-sidebar:hover .outline-title-wrapper{border-left:1px dashed}.active-tab-files #info-panel-tab-file,.active-tab-files #info-panel-tab-file:hover,.active-tab-outline #info-panel-tab-outline,.active-tab-outline #info-panel-tab-outline:hover{color:#ff8c00}.outline-title-wrapper .btn{color:inherit}.outline-item:hover{border-color:#ff8c00;background-color:#ff8c00;color:white}.typora-sourceview-on #toggle-sourceview-btn,#footer-word-count:hover,.ty-show-word-count #footer-word-count{background:var(--rawblock-edit-panel-bd)}#toggle-sourceview-btn:hover{color:var(--text-color);background:var(--rawblock-edit-panel-bd)}.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) *{color:#686868 !important}.on-focus-mode .md-end-block:not(.md-focus) img,.on-focus-mode .md-task-list-item:not(.md-focus-container)>input{opacity:#686868 !important}.on-focus-mode li[cid]:not(.md-focus-container){color:#686868}.on-focus-mode .md-fences.md-focus .CodeMirror-code>*:not(.CodeMirror-activeline) *,.on-focus-mode .CodeMirror.cm-s-inner:not(.CodeMirror-focused) *{color:#686868 !important}.on-focus-mode .md-focus,.on-focus-mode .md-focus-container{color:#fff}.on-focus-mode #typora-source .CodeMirror-code>*:not(.CodeMirror-activeline) *{color:#686868 !important}.megamenu-content,.megamenu-opened header{background:#fff}.megamenu-menu-panel h2,.megamenu-menu-panel h1,.long-btn{color:inherit}.megamenu-menu-panel input[type="text"]{background:inherit;border:0;border-bottom:1px solid}#recent-file-panel-action-btn{background:inherit;border:1px grey solid}.megamenu-menu-panel table td:nth-child(1){color:inherit;font-weight:bold}.megamenu-menu-panel tbody tr:hover td:nth-child(1){background-color:#ff8c00}.megamenu-menu{background-color:#fff}#megamenu-menu-list>li>a{border:none;color:var(--text-color)}.megamenu-menu-header .megamenu-menu-header-title-menu,.megamenu-menu-header:focus .megamenu-menu-header-title-back,.megamenu-menu-header:hover .megamenu-menu-header-title-back{display:block;color:var(--text-color)}.btn-default:hover,.btn-default:focus,.btn-default.focus,.btn-default:active,.btn-default.active,.open>.dropdown-toggle.btn-default{color:white;border:1px solid #ddd;background-color:inherit}.modal-header{border-bottom:0}.modal-footer{border-top:0}#recent-file-panel tbody tr:nth-child(2n-1){background-color:transparent !important}.megamenu-menu-panel tbody tr:hover td:nth-child(2){background-color:#ff8c00}.megamenu-menu-panel .btn{border:1px solid #eee;background:transparent}.mouse-hover .toolbar-icon.btn:hover,#w-full.mouse-hover,#w-pin.mouse-hover{background-color:inherit}#write .md-focus .md-diagram-panel{border:1px solid #ddd;margin-left:-1px;width:calc(100% + 2px)}#write .md-focus.md-fences-with-lineno .md-diagram-panel{margin-left:auto}.md-diagram-panel-error{color:tomato}.sidebar-footer-item:hover,.footer-item:hover{background:inherit;color:var(--text-color)}.ty-side-sort-btn.active,.ty-side-sort-btn:hover,.selected-folder-menu-item a:after{color:white}#sidebar-files-menu{border:solid 1px;box-shadow:4px 4px 20px rgba(0,0,0,0.79);background-color:var(--rawblock-edit-panel-bd)}.ty-preferences input[type="search"]{border-color:#ff8c00;background:var(--rawblock-edit-panel-bd);line-height:22px;border-radius:6px;color:var(--text-color)}.ty-preferences input[type="search"]:focus{box-shadow:none}.file-list-item{border-bottom:none}.file-list-item-summary{opacity:1}.file-list-item.active:first-child{border-top:none}.file-node-background{height:32px}.file-library-node.active>.file-node-content,.file-list-item.active{color:#00cd66}.file-library-node.active>.file-node-background{background-color:var(--bg-color);border-color:#ff8c00}.file-list-item.active{background-color:#222222;background-color:#ff8c00}.md-mathjax-midline{background-color:#57616b;border-bottom:none}footer.ty-footer{border-color:#656565}.ty-preferences .btn-default{background:transparent}.ty-preferences .btn-default:hover{background:var(--rawblock-edit-panel-bd)}.ty-preferences select{border:1px solid #989698;height:21px}.ty-preferences .nav-group-item.active,.export-item.active,.export-items-list-control,.export-detail{background:var(--item-hover-bg-color)}[data-is-directory="true"] .file-node-content{margin-bottom:0}.file-node-title{line-height:22px}.html-for-mac .file-node-open-state,.html-for-mac .file-node-icon{line-height:26px}.cm-s-inner.CodeMirror{background-color:#f2f2f2 !important;border:none}.cm-s-inner .CodeMirror-gutters{color:#404b53;border:none}.CodeMirror div.CodeMirror-cursor{border-left:solid 2px #ff8c00}.cm-s-inner .CodeMirror-line::selection,.cm-s-inner .CodeMirror-line::-moz-selection,.cm-s-inner .CodeMirror-line>span::selection,.cm-s-inner .CodeMirror-line>span::-moz-selection,.cm-s-inner .CodeMirror-line>span>span::selection,.cm-s-inner .CodeMirror-line>span>span::-moz-selection{background:rgba(255,255,255,0.1)}.cm-s-inner.CodeMirror-focused div.CodeMirror-selected{background:rgba(255,255,255,0.1)}.cm-s-inner .CodeMirror-linenumber{color:#6d8a88}.cm-s-inner span.cm-comment{color:#7c7c7c}.cm-s-inner span.cm-string,.cm-s-inner span.cm-string-2{color:#11c5b6}.cm-s-inner span.cm-number{color:#cd3f45}.cm-s-inner span.cm-variable{color:#55b5db}.cm-s-inner span.cm-variable-2{color:#a074c4}.cm-s-inner span.cm-def{color:#55b5db}.cm-s-inner span.cm-keyword{color:#ff79c6}.cm-s-inner span.cm-operator{color:#9fca56}.cm-s-inner span.cm-atom{color:#cd3f45}.cm-s-inner span.cm-meta{color:#55b5db}.cm-s-inner span.cm-tag{color:#55b5db}.cm-s-inner span.cm-attribute{color:#f06fd7}.cm-s-inner span.cm-qualifier{color:#9fca56}.cm-s-inner span.cm-property{color:#a074c4}.cm-s-inner span.cm-variable-3,.cm-s-inner span.cm-type{color:#9fca56}.cm-s-inner span.cm-builtin{color:#9fca56}.cm-s-inner .CodeMirror-activeline-background{background:rgba(255,255,255,0.3)}.cm-s-inner .CodeMirror-matchingbracket{text-decoration:underline;color:white !important}@media print{table,pre{page-break-inside:avoid}pre{word-wrap:break-word}}@media (prefers-color-scheme: dark){:root{--bg-color:#323232;--select-text-bg-color:#666;--text-color:#dedede;--primary-color:#ff8c00;--rawblock-edit-panel-bd:#3e3e3e;--item-hover-bg-color:#ff8c00;--control-text-hover-color:#ff8c00}#top-titlebar,#top-titlebar *{color:#666}code,kbd{padding:0.3rem;margin-right:0.4em;color:#323232;border-radius:6px;background-color:#fff}.cm-s-inner.CodeMirror{background-color:#3e3e3e !important;border:none}.cm-s-inner .CodeMirror-gutters{color:#404b53;border:none}.CodeMirror div.CodeMirror-cursor{border-left:solid 2px #ff8c00}.cm-s-inner .CodeMirror-line::selection,.cm-s-inner .CodeMirror-line::-moz-selection,.cm-s-inner .CodeMirror-line>span::selection,.cm-s-inner .CodeMirror-line>span::-moz-selection,.cm-s-inner .CodeMirror-line>span>span::selection,.cm-s-inner .CodeMirror-line>span>span::-moz-selection{background:rgba(255,255,255,0.1)}.cm-s-inner.CodeMirror-focused div.CodeMirror-selected{background:rgba(255,255,255,0.1)}.cm-s-inner .CodeMirror-linenumber{color:#6d8a88}.cm-s-inner span.cm-comment{color:#7c7c7c}.cm-s-inner span.cm-string,.cm-s-inner span.cm-string-2{color:#a8ff60}.cm-s-inner span.cm-number{color:#cd3f45}.cm-s-inner span.cm-variable{color:#55b5db}.cm-s-inner span.cm-variable-2{color:#a074c4}.cm-s-inner span.cm-def{color:#55b5db}.cm-s-inner span.cm-keyword{color:#ff79c6}.cm-s-inner span.cm-operator{color:#9fca56}.cm-s-inner span.cm-atom{color:#cd3f45}.cm-s-inner span.cm-meta{color:#55b5db}.cm-s-inner span.cm-tag{color:#018df3}.cm-s-inner span.cm-attribute{color:#e91ad8}.cm-s-inner span.cm-qualifier{color:#9fca56}.cm-s-inner span.cm-property{color:#a074c4}.cm-s-inner span.cm-variable-3,.cm-s-inner span.cm-type{color:#9fca56}.cm-s-inner span.cm-builtin{color:#9fca56}.cm-s-inner .CodeMirror-activeline-background{background:rgba(255,255,255,0.1)}.cm-s-inner .CodeMirror-matchingbracket{text-decoration:underline;color:white !important}}



</style><title>Week-19-5</title>
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='week-19-周报'><span>Week-19 周报-测试</span></h1><h2 id='📋-总结'><span>📋 总结</span></h2><p><span>本周聚焦于时间序列条件生成模型 SequentialCVAE 的完整实现与性能评估。模型在结构上引入历史序列的 LSTM 表达作为上下文信息，结合当前条件与隐变量进行解码，显著提升了多区域负荷预测的精度与分布拟合能力。通过与 CVAE、FlowCVAE 及多种回归模型的对比实验证明：SequentialCVAE 在 MSE、R²、Wasserstein 距离等指标上全面领先，特别在 Zone 1/2 的预测任务中表现出 SOTA 水平，初步验证了“上下文感知 + 分布建模”的有效性。下一阶段将聚焦多步预测结构扩展与生成能力调研</span></p><h2 id='💡-方法介绍'><span>💡 方法介绍</span></h2><p><img src="./assets/771d73a6459da9b6223796579d95ff3.png" referrerpolicy="no-referrer" alt="771d73a6459da9b6223796579d95ff3"></p><h4 id='🔍-研究动机'><span>🔍 研究动机</span></h4><p><span>我这周主要做的是一个新的生成式预测模型，叫做 </span><strong><span>SequentialCVAE</span></strong><span>。它的目标是预测电力负荷等连续变量，不只是给一个值，而是预测它可能出现在哪个区间，也就是</span><strong><span>分布建模</span></strong><span>。</span></p><h4 id='🏗️-核心思想'><span>🏗️ 核心思想</span></h4><p><span>相比传统的CVAE模型，我这个方法引入了</span><strong><span>历史信息的建模</span></strong><span>，用LSTM把过去几步的趋势变成一个上下文向量，再和当前条件、隐变量一起用于生成输出。这个结构可以理解为让模型&quot;</span><strong><span>既看眼前，也看历史</span></strong><span>&quot;，从而生成更贴合实际的结果。</span></p><p><strong><span>关键组件：</span></strong></p><ul><li><p><strong><span>序列编码器</span></strong><span>: LSTM提取历史时序依赖</span></p></li><li><p><strong><span>多模态融合</span></strong><span>: 连续特征 + 类别嵌入 + 历史上下文</span></p></li><li><p><strong><span>条件VAE</span></strong><span>: 重参数化采样 + 分布建模</span></p></li><li><p><strong><span>多任务解码</span></strong><span>: 独立预测头处理不同区域负荷</span></p></li></ul><h2 id='创新点和技术亮点'><span>创新点和技术亮点</span></h2><p><strong><span>核心创新点：</span></strong></p><p><span>我们的SequentialCVAE在传统CVAE基础上实现了两个关键突破：</span><strong><span>序列上下文感知</span></strong><span>和</span><strong><span>多模态条件融合</span></strong><span>。与现有方法只利用当前时刻信息不同，我们通过LSTM提取历史序列的时序依赖关系，形成上下文向量，让模型&quot;既看眼前，也看历史&quot;。同时，我们设计了多模态输入机制，将连续特征(天气、经济)、类别特征(时间嵌入)和目标监督信号有机融合，实现更精准的分布建模。实验结果验证了这种设计的有效性：在Zone 1/2预测任务上全面超越CVAE、FlowCVAE、XGBoost等主流方法，特别是在分布拟合指标(Wasserstein距离、KS检验)上表现突出。</span></p><p><strong><span>发文可行性评估：</span></strong></p><p><span>从技术贡献看，这是对生成式时序预测的有意义扩展，解决了现有VAE方法忽略时序依赖的问题。从实验验证看，我们有完整的对比实验和多维度指标评估，结果convincing。建议目标期刊为IEEE TPWRS或Applied Energy等电力/能源领域顶级期刊，因为负荷预测应用背景契合度高。如果强调方法论创新，也可考虑TNNLS或Pattern Recognition。预计发文成功率较高，但需要进一步完善理论分析部分，增加消融实验来验证各模块的必要性。</span></p><h2 id='sequentialcvae代码实现'><span>SequentialCVAE代码实现</span></h2><p><span>✅ 完成 SequentialCVAE 模型结构定义，包括：</span></p><ul><li><p><span>类别特征嵌入（Hour / Day / Month）</span></p></li><li><p><span>历史序列处理模块（LSTM）</span></p></li><li><p><span>编码器与解码器（共享层 + 多任务头）</span></p></li><li><p><span>重参数采样与生成器（</span><code>generate</code><span>函数）</span></p></li></ul><p><span>✅ 模型 forward 与推理流程调试完毕，可用于训练与采样</span></p><p><span>✅ 配套数据预处理流程完成，包括：</span></p><ul><li><p><span>历史序列拼接格式</span></p></li><li><p><span>当前步条件变量与目标值分离</span></p></li></ul><p><span>✅ 指标评估覆盖 MSE、MAE、MAPE、SMAPE、R²、Wasserstein、KS、Skewness 差异</span></p><p><span>✅ 与 CVAE、FlowCVAE、LSTM、XGBoost 等多个 baseline 模型对比，SequentialCVAE 在 Zone 1/2 取得全指标第一，Zone 3 部分指标优于传统模型</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.52344px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ===================================================================</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># SequentialCVAE: 序列感知的条件变分自编码器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 核心创新：将历史序列的LSTM表达作为上下文信息，结合多模态条件进行生成式预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 技术亮点：历史记忆 + 多模态融合 + 分布建模 + 多任务学习</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ===================================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">torch</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">torch</span>.<span class="cm-property">nn</span> <span class="cm-keyword">as</span> <span class="cm-variable">nn</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">SequentialCVAE</span>(<span class="cm-variable">nn</span>.<span class="cm-property">Module</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  SequentialCVAE模型 - 让AI不仅看当前，还能'回忆过去'来做更准确的预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  参数说明：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  - target_dim: 预测目标维度（3个区域的负荷）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  - cont_cond_dim: 连续条件特征维度（天气、经济等）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  - latent_dim: 潜在空间维度（VAE的核心，控制生成多样性）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  - sequence_length: 历史序列长度（看多少步历史，如过去7天）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  - cat_dims: 类别特征维度字典（Hour/Day/Month的取值范围）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  - embedding_dims: 嵌入层维度字典（时间特征的嵌入大小）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  - hidden_dim: LSTM隐层维度（控制'记忆容量'，默认128）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">target_dim</span>, <span class="cm-variable">cont_cond_dim</span>, <span class="cm-variable">latent_dim</span>, <span class="cm-variable">sequence_length</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cat_dims</span>, <span class="cm-variable">embedding_dims</span>, <span class="cm-variable">hidden_dim</span><span class="cm-operator">=</span><span class="cm-number">128</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super</span>(<span class="cm-variable">SequentialCVAE</span>, <span class="cm-variable-2">self</span>).<span class="cm-property">__init__</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 保存关键参数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">target_dim</span> <span class="cm-operator">=</span> <span class="cm-variable">target_dim</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">latent_dim</span> <span class="cm-operator">=</span> <span class="cm-variable">latent_dim</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">sequence_length</span> <span class="cm-operator">=</span> <span class="cm-variable">sequence_length</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">cont_cond_dim</span> <span class="cm-operator">=</span> <span class="cm-variable">cont_cond_dim</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 1. 类别特征嵌入层 - 时间信息的"身份证"系统</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 作用：把时间信息转换成神经网络能理解的数字向量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 例如：早上8点 → [0.2, 0.8, 0.1, ...]，周一 → [0.9, 0.3, 0.5, ...]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">hour_embed</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Embedding</span>(<span class="cm-variable">cat_dims</span>[<span class="cm-string">'Hour'</span>], <span class="cm-variable">embedding_dims</span>[<span class="cm-string">'Hour'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">day_embed</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Embedding</span>(<span class="cm-variable">cat_dims</span>[<span class="cm-string">'DayOfWeek'</span>], <span class="cm-variable">embedding_dims</span>[<span class="cm-string">'DayOfWeek'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">month_embed</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Embedding</span>(<span class="cm-variable">cat_dims</span>[<span class="cm-string">'Month'</span>], <span class="cm-variable">embedding_dims</span>[<span class="cm-string">'Month'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">total_embedding_dim</span> <span class="cm-operator">=</span> <span class="cm-builtin">sum</span>(<span class="cm-variable">embedding_dims</span>.<span class="cm-property">values</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 2. 历史序列处理模块 - 核心创新！LSTM"记忆模块"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 作用：像一个有选择性记忆的大脑，从历史数据中提取时序规律</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 输入：历史的[天气+负荷+时间]信息</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 输出：一个浓缩的'历史经验向量'（128维）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 意义：模型能说"根据过去一周的用电模式，我记住了这个规律..."</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 历史数据包含：连续条件特征(5) + 目标特征(3) + 类别特征嵌入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_input_dim</span> <span class="cm-operator">=</span> <span class="cm-variable">cont_cond_dim</span> <span class="cm-operator">+</span> <span class="cm-variable">target_dim</span> <span class="cm-operator">+</span> <span class="cm-variable">total_embedding_dim</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">hist_lstm</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">LSTM</span>(<span class="cm-variable">hist_input_dim</span>, <span class="cm-variable">hidden_dim</span>, <span class="cm-variable">batch_first</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>, <span class="cm-variable">num_layers</span><span class="cm-operator">=</span><span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 3. 当前条件处理 - 现状分析模块</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 作用：处理当前时刻的环境条件（天气、时间等）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">curr_cond_dim</span> <span class="cm-operator">=</span> <span class="cm-variable">cont_cond_dim</span> <span class="cm-operator">+</span> <span class="cm-variable">total_embedding_dim</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 4. 编码器 (Encoder) - "理解和压缩"专家</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 作用：把[当前真实值 + 历史记忆 + 当前条件]压缩成潜在特征</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 输出：潜在空间的均值μ和方差σ²</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 意义：回答"基于所有信息，核心的用电规律特征是什么？"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">encoder_input_dim</span> <span class="cm-operator">=</span> <span class="cm-variable">target_dim</span> <span class="cm-operator">+</span> <span class="cm-variable">hidden_dim</span> <span class="cm-operator">+</span> <span class="cm-variable">curr_cond_dim</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">encoder_net</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-variable">encoder_input_dim</span>, <span class="cm-number">256</span>), &nbsp; &nbsp;<span class="cm-comment"># 第一层：信息融合</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 激活函数：增加非线性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(<span class="cm-number">0.1</span>), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 防过拟合：随机丢弃10%神经元</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">256</span>, <span class="cm-number">128</span>), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 第二层：特征提取</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(<span class="cm-number">0.1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">fc_mu</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">128</span>, <span class="cm-variable">latent_dim</span>) &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 输出均值μ："最可能的情况"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">fc_log_var</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">128</span>, <span class="cm-variable">latent_dim</span>) <span class="cm-comment"># 输出log方差："不确定性大小"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 5. 解码器 (Decoder) - "想象大师"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 作用：从潜在特征z重构出预测结果</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 输入：[潜在变量z + 历史记忆 + 当前条件]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 输出：3个区域的电力负荷预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 关键：同样的条件，不同的z能生成多样的预测结果</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===============================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">decoder_input_dim</span> <span class="cm-operator">=</span> <span class="cm-variable">latent_dim</span> <span class="cm-operator">+</span> <span class="cm-variable">hidden_dim</span> <span class="cm-operator">+</span> <span class="cm-variable">curr_cond_dim</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">decoder_shared</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Sequential</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-variable">decoder_input_dim</span>, <span class="cm-number">128</span>), &nbsp; &nbsp;<span class="cm-comment"># 共享特征提取层</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(<span class="cm-number">0.1</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">128</span>, <span class="cm-number">256</span>), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 特征扩展层</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">ReLU</span>(),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nn</span>.<span class="cm-property">Dropout</span>(<span class="cm-number">0.1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 多任务输出头 - 分区域预测，每个区域有独立的预测头</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">decoder_zone1</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">256</span>, <span class="cm-number">1</span>) &nbsp; <span class="cm-comment"># Zone 1 专用预测器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">decoder_zone2</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">256</span>, <span class="cm-number">1</span>) &nbsp; <span class="cm-comment"># Zone 2 专用预测器 &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">decoder_zone3</span> <span class="cm-operator">=</span> <span class="cm-variable">nn</span>.<span class="cm-property">Linear</span>(<span class="cm-number">256</span>, <span class="cm-number">1</span>) &nbsp; <span class="cm-comment"># Zone 3 专用预测器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">process_categorical_features</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">cat_features</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  类别特征处理函数 - 智能的"时间翻译器"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  功能：自动处理两种情况的时间数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  1. 历史序列：一连串时间点 [8点, 9点, 10点...] &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  2. 当前时刻：单个时间点 [现在是15点]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输入：cat_features - 形状可能是(batch_size, 3)或(batch_size, seq_len, 3)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输出：对应的嵌入向量，把时间转换成模型能'读懂'的数字语言</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  比喻：像一个翻译器，把人类的时间概念翻译成AI能理解的向量表示</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">len</span>(<span class="cm-variable">cat_features</span>.<span class="cm-property">shape</span>) <span class="cm-operator">==</span> <span class="cm-number">3</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 处理序列数据：(batch_size, seq_len, 3)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 情况：历史时间序列，需要对每个时间步都做嵌入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">batch_size</span>, <span class="cm-variable">seq_len</span>, <span class="cm-variable">_</span> <span class="cm-operator">=</span> <span class="cm-variable">cat_features</span>.<span class="cm-property">shape</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hour_emb</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">hour_embed</span>(<span class="cm-variable">cat_features</span>[:, :, <span class="cm-number">0</span>]) &nbsp;<span class="cm-comment"># 小时嵌入: (batch_size, seq_len, emb_dim)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">day_emb</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">day_embed</span>(<span class="cm-variable">cat_features</span>[:, :, <span class="cm-number">1</span>]) &nbsp; &nbsp;<span class="cm-comment"># 星期嵌入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">month_emb</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">month_embed</span>(<span class="cm-variable">cat_features</span>[:, :, <span class="cm-number">2</span>]) <span class="cm-comment"># 月份嵌入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>([<span class="cm-variable">hour_emb</span>, <span class="cm-variable">day_emb</span>, <span class="cm-variable">month_emb</span>], <span class="cm-variable">dim</span><span class="cm-operator">=</span><span class="cm-number">2</span>) &nbsp;<span class="cm-comment"># 沿特征维度拼接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 处理单时间步数据：(batch_size, 3) &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 情况：当前时刻，只需要对当前时间做嵌入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hour_emb</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">hour_embed</span>(<span class="cm-variable">cat_features</span>[:, <span class="cm-number">0</span>]) &nbsp; &nbsp; <span class="cm-comment"># 当前小时</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">day_emb</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">day_embed</span>(<span class="cm-variable">cat_features</span>[:, <span class="cm-number">1</span>]) &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 当前星期</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">month_emb</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">month_embed</span>(<span class="cm-variable">cat_features</span>[:, <span class="cm-number">2</span>]) &nbsp; <span class="cm-comment"># 当前月份</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>([<span class="cm-variable">hour_emb</span>, <span class="cm-variable">day_emb</span>, <span class="cm-variable">month_emb</span>], <span class="cm-variable">dim</span><span class="cm-operator">=</span><span class="cm-number">1</span>) &nbsp;<span class="cm-comment"># 沿特征维度拼接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">process_history</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">hist_data</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  历史序列处理函数 - 核心创新！时序"记忆提取器"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  这是我们最重要的创新点！让模型能够从历史中学习规律</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  工作流程：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  1. 特征分离：把历史数据按类型分开（连续/目标/类别）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  2. 嵌入转换：将时间类别转换为向量表示 &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  3. LSTM记忆：通过LSTM提取时序依赖关系</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  4. 上下文生成：输出浓缩的历史经验向量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输入：hist_data - (batch_size, seq_len-1, 全部特征)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输出：hist_context - (batch_size, hidden_dim) 历史上下文向量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  比喻：就像问模型"根据过去一周，你学到了什么规律？"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  模型回答："我学到了这128个数字代表的用电经验！"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 容错处理：确保输入是3D张量，即使seq_len=1也要有序列维度</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">len</span>(<span class="cm-variable">hist_data</span>.<span class="cm-property">shape</span>) <span class="cm-operator">==</span> <span class="cm-number">2</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 如果是2D张量，说明seq_len=1，需要增加序列维度</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_data</span> <span class="cm-operator">=</span> <span class="cm-variable">hist_data</span>.<span class="cm-property">unsqueeze</span>(<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">batch_size</span>, <span class="cm-variable">seq_len</span>, <span class="cm-variable">total_features</span> <span class="cm-operator">=</span> <span class="cm-variable">hist_data</span>.<span class="cm-property">shape</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===== 特征分离阶段 =====</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 把历史数据按照特征类型进行分离，就像整理档案一样分类处理</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 连续条件特征：前cont_cond_dim列（天气、经济指标等）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_cont</span> <span class="cm-operator">=</span> <span class="cm-variable">hist_data</span>[:, :, :<span class="cm-variable-2">self</span>.<span class="cm-property">cont_cond_dim</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 目标特征：接下来target_dim列（历史的电力负荷值） &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_target</span> <span class="cm-operator">=</span> <span class="cm-variable">hist_data</span>[:, :, <span class="cm-variable-2">self</span>.<span class="cm-property">cont_cond_dim</span>:<span class="cm-variable-2">self</span>.<span class="cm-property">cont_cond_dim</span> <span class="cm-operator">+</span> <span class="cm-variable-2">self</span>.<span class="cm-property">target_dim</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 类别特征：最后3列 (Hour, DayOfWeek, Month)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_cat</span> <span class="cm-operator">=</span> <span class="cm-variable">hist_data</span>[:, :, <span class="cm-variable-2">self</span>.<span class="cm-property">cont_cond_dim</span> <span class="cm-operator">+</span> <span class="cm-variable-2">self</span>.<span class="cm-property">target_dim</span>:].<span class="cm-property">long</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===== 嵌入转换阶段 =====</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 将历史时间信息转换为嵌入向量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_cat_emb</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">process_categorical_features</span>(<span class="cm-variable">hist_cat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===== 特征融合阶段 =====</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 将所有类型的历史特征拼接成完整的输入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 形状：(batch_size, seq_len, hist_input_dim)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_combined</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>([<span class="cm-variable">hist_cont</span>, <span class="cm-variable">hist_target</span>, <span class="cm-variable">hist_cat_emb</span>], <span class="cm-variable">dim</span><span class="cm-operator">=</span><span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># ===== LSTM记忆提取阶段 =====</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 这是关键！LSTM像大脑一样处理时序信息</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 输入：完整的历史序列 &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 输出：每个时间步的隐状态 + 最终的记忆状态</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lstm_out</span>, (<span class="cm-variable">hidden</span>, <span class="cm-variable">cell</span>) <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">hist_lstm</span>(<span class="cm-variable">hist_combined</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 使用最后一个时间步的输出作为历史上下文</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 这个向量包含了从整个历史序列中提取的时序模式和规律</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_context</span> <span class="cm-operator">=</span> <span class="cm-variable">lstm_out</span>[:, <span class="cm-operator">-</span><span class="cm-number">1</span>, :] &nbsp;<span class="cm-comment"># 形状：(batch_size, hidden_dim)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">hist_context</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">encode</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>, <span class="cm-variable">hist_data</span>, <span class="cm-variable">curr_cont</span>, <span class="cm-variable">curr_cat</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  编码器函数 - "经验丰富的预测专家"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  作用：像一个有经验的分析师，综合所有信息形成判断</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  工作流程（就像专家分析过程）：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  1. 回顾历史："让我先看看过去发生了什么"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  2. 分析现状："当前的天气、时间条件如何"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  3. 结合真实："实际的电力需求是多少" </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  4. 形成判断："基于这些，我认为潜在的用电规律是..."</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输入：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - x: 当前真实的目标值（训练时使用）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - hist_data: 历史序列数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - curr_cont: 当前连续条件特征</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - curr_cat: 当前类别特征</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输出：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - mu: 潜在分布的均值（"我觉得最可能的情况是这样"）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - log_var: 潜在分布的对数方差（"但我的不确定性有多大"）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 1. 提取历史上下文 - "回顾历史经验"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_context</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">process_history</span>(<span class="cm-variable">hist_data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 2. 处理当前条件 - "分析当前环境"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">curr_cat_emb</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">process_categorical_features</span>(<span class="cm-variable">curr_cat</span>) &nbsp;<span class="cm-comment"># 时间嵌入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">curr_cond</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>([<span class="cm-variable">curr_cont</span>, <span class="cm-variable">curr_cat_emb</span>], <span class="cm-variable">dim</span><span class="cm-operator">=</span><span class="cm-number">1</span>) &nbsp; &nbsp;<span class="cm-comment"># 融合当前条件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 3. 三重信息融合 - "综合分析"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># [当前真实值 + 历史经验 + 当前条件] → 完整的决策依据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">inputs</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>([<span class="cm-variable">x</span>, <span class="cm-variable">hist_context</span>, <span class="cm-variable">curr_cond</span>], <span class="cm-variable">dim</span><span class="cm-operator">=</span><span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 4. 神经网络编码 - "形成专业判断"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">h</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">encoder_net</span>(<span class="cm-variable">inputs</span>) &nbsp;<span class="cm-comment"># 特征提取和变换</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 5. 输出潜在空间参数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable-2">self</span>.<span class="cm-property">fc_mu</span>(<span class="cm-variable">h</span>), <span class="cm-variable-2">self</span>.<span class="cm-property">fc_log_var</span>(<span class="cm-variable">h</span>) &nbsp;<span class="cm-comment"># μ和log(σ²)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">reparameterize</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">mu</span>, <span class="cm-variable">log_var</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  重参数化技巧 - VAE的精髓！"随机性注入器"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  核心思想：不直接使用均值μ，而是加入随机性来模拟真实世界的不确定性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  公式：z = μ + σ × ε，其中ε ~ N(0,1)是随机噪声</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  意义：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - 让模型能生成多样性的预测，不是死板的一个数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - 同样的输入，每次生成稍微不同的结果</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - 模拟真实世界用电需求的随机波动</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  比喻：像在精确的预测上撒一点"创造力的粉末"，让结果更真实</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">std</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">exp</span>(<span class="cm-number">0.5</span> <span class="cm-operator">*</span> <span class="cm-variable">log_var</span>) &nbsp;<span class="cm-comment"># 从log方差恢复标准差：σ = exp(0.5 * log(σ²))</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">eps</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">randn_like</span>(<span class="cm-variable">std</span>) &nbsp; &nbsp; <span class="cm-comment"># 生成同样形状的标准正态噪声</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">mu</span> <span class="cm-operator">+</span> <span class="cm-variable">eps</span> <span class="cm-operator">*</span> <span class="cm-variable">std</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 重参数化：z = μ + σ * ε</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">decode</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">z</span>, <span class="cm-variable">hist_data</span>, <span class="cm-variable">curr_cont</span>, <span class="cm-variable">curr_cat</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  解码器函数 - "想象大师"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  作用：从抽象的潜在特征z重构出具体的预测结果</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  工作流程：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  1. 输入潜在密码：接收编码器生成的'潜在特征z'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  2. 回忆历史：同样需要历史上下文来指导生成</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  3. 考虑现状：结合当前的环境条件 &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  4. 分区域预测：分别预测3个区域的电力需求</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  5. 输出归一化：确保结果在合理范围内</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  关键优势：同一个历史和条件，通过不同的z可以生成多种可能的预测！</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输入：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - z: 潜在空间的采样点（包含生成所需的"基因"）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - hist_data, curr_cont, curr_cat: 与编码器相同的条件信息</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输出：3个区域的电力负荷预测值，范围在[0,1]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 1. 重新提取历史上下文（解码时也需要历史指导）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hist_context</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">process_history</span>(<span class="cm-variable">hist_data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 2. 处理当前条件（与编码器保持一致）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">curr_cat_emb</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">process_categorical_features</span>(<span class="cm-variable">curr_cat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">curr_cond</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>([<span class="cm-variable">curr_cont</span>, <span class="cm-variable">curr_cat_emb</span>], <span class="cm-variable">dim</span><span class="cm-operator">=</span><span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 3. 融合潜在变量与条件信息</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># [潜在特征z + 历史记忆 + 当前条件] → 生成的完整依据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">inputs</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">cat</span>([<span class="cm-variable">z</span>, <span class="cm-variable">hist_context</span>, <span class="cm-variable">curr_cond</span>], <span class="cm-variable">dim</span><span class="cm-operator">=</span><span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 4. 共享解码网络 - "基础想象力"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">h_shared</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">decoder_shared</span>(<span class="cm-variable">inputs</span>) &nbsp;<span class="cm-comment"># 提取共同特征</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 5. 多任务输出头 - "专业化预测"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 每个区域都有专门的预测器，因为不同区域的用电模式可能不同</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out1</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">decoder_zone1</span>(<span class="cm-variable">h_shared</span>) &nbsp;<span class="cm-comment"># Zone 1的专业预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out2</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">decoder_zone2</span>(<span class="cm-variable">h_shared</span>) &nbsp;<span class="cm-comment"># Zone 2的专业预测 &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out3</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">decoder_zone3</span>(<span class="cm-variable">h_shared</span>) &nbsp;<span class="cm-comment"># Zone 3的专业预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 6. 输出归一化 - "确保合理性"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># sigmoid函数确保输出在[0,1]范围内，代表归一化的负荷比例</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">torch</span>.<span class="cm-property">sigmoid</span>(<span class="cm-variable">torch</span>.<span class="cm-property">cat</span>([<span class="cm-variable">out1</span>, <span class="cm-variable">out2</span>, <span class="cm-variable">out3</span>], <span class="cm-variable">dim</span><span class="cm-operator">=</span><span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">forward</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">x</span>, <span class="cm-variable">hist_data</span>, <span class="cm-variable">curr_cont</span>, <span class="cm-variable">curr_cat</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  前向传播函数 - 训练时的完整流程</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  这是训练阶段的主要接口，执行完整的编码-解码过程</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  流程：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  1. 编码：[真实数据 + 历史 + 条件] → 潜在空间参数(μ, σ²)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  2. 采样：从潜在分布中采样得到z &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  3. 解码：[z + 历史 + 条件] → 重构预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  4. 返回：预测结果 + 潜在参数（用于计算KL散度损失）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  比喻：完整的"学习-理解-重现"过程</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 第一步：编码 - "理解和抽象"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">mu</span>, <span class="cm-variable">log_var</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">encode</span>(<span class="cm-variable">x</span>, <span class="cm-variable">hist_data</span>, <span class="cm-variable">curr_cont</span>, <span class="cm-variable">curr_cat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 第二步：重参数化采样 - "注入随机性" &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">z</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">reparameterize</span>(<span class="cm-variable">mu</span>, <span class="cm-variable">log_var</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 第三步：解码重构 - "生成预测"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">reconstruction</span> <span class="cm-operator">=</span> <span class="cm-variable-2">self</span>.<span class="cm-property">decode</span>(<span class="cm-variable">z</span>, <span class="cm-variable">hist_data</span>, <span class="cm-variable">curr_cont</span>, <span class="cm-variable">curr_cat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 返回重构结果和潜在参数（后者用于KL损失计算）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">reconstruction</span>, <span class="cm-variable">mu</span>, <span class="cm-variable">log_var</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@torch</span>.<span class="cm-property">no_grad</span>() &nbsp;<span class="cm-comment"># 推理时不需要梯度计算，提高效率</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">generate</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">hist_data</span>, <span class="cm-variable">curr_cont</span>, <span class="cm-variable">curr_cat</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  生成函数 - 预测时的使用接口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  这是实际应用时的预测接口，不需要真实标签</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  工作原理：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  1. 随机采样：从标准正态分布N(0,I)中采样潜在变量z</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  2. 条件解码：结合历史和当前条件，解码生成预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  3. 多样性：多次调用可得到不同预测，量化不确定性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输入：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - hist_data: 历史序列（过去的数据）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - curr_cont: 当前连续条件（当前天气等） &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - curr_cat: 当前类别条件（当前时间）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  输出：3个区域的电力负荷预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  应用场景：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - 单次预测：调用一次获得点预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - 不确定性量化：多次调用获得预测分布</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  - 风险评估：分析预测结果的变异性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string"> &nbsp; &nbsp; &nbsp;  """</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 从标准正态分布采样潜在变量</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 形状与batch_size匹配，设备与输入数据一致</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">z</span> <span class="cm-operator">=</span> <span class="cm-variable">torch</span>.<span class="cm-property">randn</span>(<span class="cm-variable">curr_cont</span>.<span class="cm-property">size</span>(<span class="cm-number">0</span>), <span class="cm-variable-2">self</span>.<span class="cm-property">latent_dim</span>, <span class="cm-variable">device</span><span class="cm-operator">=</span><span class="cm-variable">curr_cont</span>.<span class="cm-property">device</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 基于采样的z和给定条件生成预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable-2">self</span>.<span class="cm-property">decode</span>(<span class="cm-variable">z</span>, <span class="cm-variable">hist_data</span>, <span class="cm-variable">curr_cont</span>, <span class="cm-variable">curr_cat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ===================================================================</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 模型使用总结：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 🌟 核心创新点：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 1. 历史记忆：LSTM提取时序依赖，让预测有"历史经验"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 2. 多模态融合：连续+类别+目标特征，信息利用最大化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 3. 分布建模：VAE框架提供不确定性量化，不只是点预测</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 4. 多任务学习：一个模型同时预测多个区域，共享知识</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 🚀 实际优势：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># - 更准确：历史上下文让预测更精准</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># - 更智能：自动学习时序规律和时间模式 &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># - 更鲁棒：分布建模处理不确定性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># - 更实用：多区域预测，实际应用价值高</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 📊 性能表现：</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># - 19/21个指标超越所有基线模型</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># - Zone 1/2 达到SOTA水平</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># - 分布拟合指标显著优于传统方法</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># - 验证了"序列上下文感知 + 分布建模"的有效性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ===================================================================</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 9495px;"></div><div class="CodeMirror-gutters" style="display: none; height: 9495px;"></div></div></div></pre><h2 id='🏆-performance速览'><strong><span>🏆 Performance速览</span></strong></h2><iframe src="./performance_visualization.html"
        width="100%"
        height="2700px"
        frameborder="0">
</iframe><p>&nbsp;</p><p>&nbsp;</p></div></div>
</body>
</html>